SKILL={
	SKILL_EXECUTION_TYPE=,
}
SKILL:[SPELL,HERO_SPECIALTY_SKILL,HERO_SECONDARY_SKILL,UNIT_SKILL]
SKILL_EXECUTION_TYPE:[ACTIVE,PASSIVE]

SPELL:[
	SPELL_BLOODLUST,
	SPELL_CURE,
	SPELL_HASTE,
	SPELL_STONE_SKIN,
	SPELL_DISRUPTING_RAY,
]

HERO_SPECIALTY_SKILL:[
	SPECIALTY_SKILL_BALLISTA,
	SPECIALTY_SKILL_DISRUPTING_RAY,
]

HERO_SECONDARY_SKILL:[
	SECONDARY_SKILL_SCOUTING,
	SECONDARY_SKILL_EARTH_MAGIC,
	SECONDARY_SKILL_TACTICS,
	SECONDARY_SKILL_LOGISTICS,
	SECONDARY_SKILL_NECROMANCY,
	SECONDARY_SKILL_RESISTANCE,
	SECONDARY_SKILL_LEADERSHIP,
	SECONDARY_SKILL_ARTILLERY,
	SECONDARY_SKILL_WISDOM,
	SECONDARY_SKILL_AIR_MAGIC,
]

UNIT_SKILL:[
	SKILL_ARCHANGEL_RESURRECTION,
	SKILL_ARCHANGEL_HATRED,
	SKILL_ARCHANGEL_MORALE_BOOST,
	SKILL_PHOENIX_REBIRTH,
	SKILL_MAGIC_RESISTANCE,
]

SPECIALTY_SKILL=HERO_SPECIALTY_SKILL # Direct list assignment
SECONDARY_SKILL=HERO_SECONDARY_SKILL # Direct list assignment

##########
# Spells #
##########

SPELL_BLOODLUST(UNIT,EXECUTION_WHEN,ATTACK_BONUS,TARGET_TYPE,TARGET_COUNT,ROUND)={
	EXECUTION=ACTIVE,
	EXECUTION_WHEN=EXECUTION_WHEN,
	CHANNELLING=INSTANT,
	DURATION=ROUND,
	DURATION_TYPE=ROUND_BASED,
	TARGET_TYPE=TARGET_TYPE,
	EXCLUDED_TARGET=[UNDEAD,NONLIVING,ELEMENTAL,MACHINE],
	MODIFIER={
		ON=UNIT.EFFECT,
		FUNCTION=FUNC_CURSE,
		FUNCTION_PARAMETER=[UNIT.EFFECT,ATTACK_BONUS,UNIT.MELEE_ATTACK],
	},
	MAGIC_GUIDE_APPEARANCE_PROBABILITY={
		INFERNO=0.53,
		NECROPOLIS=0.32,
		DUNGEON=0.3,
		STRONGHOLD=0.53,
		FORTRESS=0.31,
		CONFLUX=0.31,
	},
}
SPELL_BLOODLUST:[SPELL_BLOODLUST_BASIC,SPELL_BLOODLUST_ADVANCED,SPELL_BLOODLUST_EXPERT]
SPELL_BLOODLUST_BASIC=SPELL_BLOODLUST(?,AFTER_USER_SELECT_UNIT,3,FRIENDLY_SINGLE,?)
SPELL_BLOODLUST_ADVANCED=SPELL_BLOODLUST(?,AFTER_USER_SELECT_UNIT,6,FRIENDLY_SINGLE,?)
SPELL_BLOODLUST_EXPERT=SPELL_BLOODLUST(?,AFTER_USER_SELECT_SKILL,6,FRIENDLY_ALL,?)


SPELL_CURE(UNIT,EXECUTION_WHEN,CURE_POINT,TARGET_TYPE,POWER)={
	EXECUTION=ACTIVE,
	EXECUTION_WHEN=EXECUTION_WHEN,
	CHANNELLING=INSTANT,
	DURATION=INSTANT,
	DURATION_TYPE=NONE,
	TARGET_TYPE=TARGET_TYPE,
	EXCLUDED_TARGET=[UNDEAD,NONLIVING,ELEMENTAL,MACHINE],
	MODIFIER={
		[
			ON=UNIT.HP,
			FUNCTION=FUNC_CURE,
			FUNCTION_PARAMETER=[CURE_POINT,POWER,UNIT.MAX_HP],
		],
		[
			ON=UNIT.EFFECT,
			FUNCTION=REMOVE_IF,
			FUNCTION_PARAMETER=[
				UNIT.EFFECT,
				LAMBDA(IF(_.TYPE.EQUALS(NEGATIVE)))
			],
		],
	},
	MAGIC_GUIDE_APPEARANCE_PROBABILITY={
		CASTLE=0.54,
		RAMPART=0.54,
		TOWER=0.39,
		TOWER_NO_LIB=0.31,
		INFERNO=0.31,
		DUNGEON=0.3,
		STRONGHOLD=0.31,
		FORTRESS=0.53,
		CONFLUX=0.31,
	},
}
SPELL_CURE:[SPELL_CURE_BASIC,SPELL_CURE_ADVANCED,SPELL_CURE_EXPERT]
SPELL_CURE_BASIC=SPELL_CURE(?,AFTER_USER_SELECT_UNIT,10,FRIENDLY_SINGLE,?)
SPELL_CURE_ADVANCED=SPELL_CURE(?,AFTER_USER_SELECT_UNIT,20,FRIENDLY_SINGLE,?)
SPELL_CURE_EXPERT=SPELL_CURE(?,AFTER_USER_SELECT_SKILL,30,FRIENDLY_ALL,?)

###############
# Unit skills #
###############

SKILL_ARCHANGEL_RESURRECTION(STACK_NUMBER)={
	EXECUTION=ACTIVE,
	EXECUTION_WHEN=AFTER_USER_SELECT_UNIT,
	CHANNELLING=INSTANT,
	DURATION=PERMANENT,
	TARGET_TYPE=FRIENDLY_SINGLE,
	TARGET_COUNT=1,
	EXCLUDED_TARGET=[UNDEAD,NONLIVING,ELEMENTAL,MACHINE],
	MODIFIER={
		ON=HP,
		FUNCTION=MULTIPLY,
		FUNCTION_PARAMETER=[100,STACK_NUMBER],
	},
}

SKILL_HATRED(TARGET,DAMAGE)={
	EXECUTION=PASSIVE,
	EXECUTION_WHEN=WHOLE_BATTLE,
	CHANNELLING=NO,
	DURATION=BATTLE,
	TARGET_TYPE=ENEMY_BY_TYPE,
	TARGET=TARGET,
	MODIFIER={
		ON=DAMAGE,
		FUNCTION=ADD,
		FUNCTION_PARAMETER=[1.5,ON],
	},
}

SKILL_HATRED:[SKILL_ARCHANGEL_HATRED,SKILL_ANGEL_HATRED,SKILL_ARCHDEMON_HATRED,SKILL_DEMON_HATRED,SKILL_BLACK_DRAGON_HATRED]

# Skill inheritance
SKILL_ARCHANGEL_HATRED=SKILL_HATRED([DEVIL,ARCHDEVIL],DAMAGE)

# Archangel Morale Boost is applied for the whole battle.
# Returns the modified/boosted morale on all friendly units.
SKILL_ARCHANGEL_MORALE_BOOST={
	EXECUTION=PASSIVE,
	EXECUTION_WHEN=WHOLE_BATTLE,
	CHANNELLING=NO,
	DURATION=BATTLE,
	TARGET_TYPE=FRIENDLY_ALL,
	EXCLUDED_TARGET=[UNDEAD,NONLIVING,ELEMENTAL,MACHINE],
	MODIFIER={
		ON=MORALE,
		FUNCTION=ADD,
		FUNCTION_PARAMETER=[1,ON],
	},
}

# Phoenix rebirth is triggered after a Phoenix stack enters Death state.
# Requires the stack's stack number.
# Returns the stack number which can be revived.
SKILL_PHOENIX_REBIRTH(STACK_NUMBER)={
	EXECUTION=PASSIVE,
	EXECUTION_WHEN=AFTER_DEATH,
	CHANNELLING=NO,
	DURATION=PERMANENT,
	TARGET_TYPE=SELF,
	MODIFIER={
		ON=STACK_NUMBER,
		FUNCTION=FUNC_PHOENIX_REBIRTH,
		FUNCTION_PARAMETER=[0.2,STACK_NUMBER],
	}
}

# Magic resistance is settled when a unit is hit by magic.
# Requires the magic's labels, and the incoming damage.
# Returns the damage after resistance is applied.
SKILL_MAGIC_RESISTANCE(TARGET_MAGIC,RESISTANCE_RATIO,HIT_BY_MAGIC_TYPE,DAMAGE)={
	EXECUTION=PASSIVE_BEFORE_HIT_BY_MAGIC,
	EXECUTION_WHEN=BEFORE_HIT_BY,
	EXECUTION_WHEN_PARAMETER=MAGIC,
	EXECUTION_FUNCTION_PARAMETER=INCOMING_MAGIC_TYPE,
	CHANNELLING=NO,
	DURATION=BATTLE,
	TARGET_TYPE=SELF,
	TARGET=TARGET_MAGIC,
	MODIFIER={
		ON=DAMAGE,
		FUNCTION=FUNC_MAGIC_RESISTANCE,
		FUNCTION_PARAMETER=[TARGET,HIT_BY_MAGIC_TYPE,RESISTANCE_RATIO,DAMAGE],
	},
}
